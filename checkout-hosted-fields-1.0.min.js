UltraCartHostedFields=function(e,t,r,o,a,i,n,s,l){console&&console.log&&l||(l=!1),"undefined"==typeof s&&(s=["paddingBottom","paddingLeft","paddingRight","paddingTop","lineHeight","fontSize","fontFamily","fontStyle","fontWeight","backgroundColor","color","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth"]),"undefined"==typeof e&&alert("jQuery is not loaded.  This is required for UltraCart hosted fields.  Add jQuery to your page."),"object"==typeof t&&"function"==typeof t.parse||alert("JSON is not supported.  This is required for UltraCart hosted fields.  Add a JSON polyfill script on your page.");var d=this;d.sessionCredentials=o,d.form=a,d.cssUrls=i,d.fieldIdCounter=0,d.fields=[],d.preventIPadSelectCrashes=function(){var t=1;e("select").each(function(){var r=e(this),o=r.parent();"static"===o.css("position")&&(o.css("position","relative"),l&&console.log("Changed position of ",o," from static to relative."));var a=e("<input>",{id:"selectOverlay"+t,type:"text",style:"border: none; background: transparent;","z-index":n});r.after(a),e(document).on("focus","#selectOverlay"+t,function(){e(this).blur(),e(this).css("z-index",-1e3),r.focus()}),r.on("blur",function(){a.css("z-index",n)}),d.maintainSelectOverlay(r,a),t++})},d.setupField=function(t,o){var a=this;if("creditCardNumber"===t||"creditCardCvv2"===t){var i;i=o.selectorContext?e(o.selector,o.selectorContext):e(o.selector),i.attr("type")&&"number"===i.attr("type")&&alert("Please change input type for "+o.selector+" from number to text."),o.value||(o.value=i.val()),o.placeholder||(o.placeholder=i.attr("placeholder"));var n=i.parent();"static"===n.css("position")&&(n.css("position","relative"),l&&console.log("Changed position of ",n," from static to relative.")),i.after("<div id='"+t+"Overlay'></div>");var s=e("#"+t+"Overlay"),c=null;o.tokenSelector&&(c=e(o.tokenSelector)),d.matchOverlay(i,s),e(r).resize(function(){d.matchOverlay(i,s)});var f={};d.fieldIdCounter++,f.id=d.fieldIdCounter,f.fieldType=t,f.fieldConfig=o,f.loaded=!1,f.bufferedMessages=[],f.receiveMessageHandler=a.fieldReceiveMessageHandler,f.callback=o.callback,o.callback=null,f.change=o.change,o.change=null,f.change?l&&console.log("Custom change handler specified in field config for "+t):(l&&console.log("No change handler on field "+t+".  Adding default change handler."),f.change=function(e){l&&console.log("change handler called for value for underlying field ",i),f.lastUnderlyingVal=e,i.val(e),l&&console.log("New value of underlying field ",i," is ",i.val()),i.trigger("change"),l&&console.log("New value of underlying field after trigger:change on ",i," is ",i.val())}),f.container=s,f.parent=n,f.underlying=i,f.tokenHolder=c,f.lastUnderlyingVal=i.val(),f.underlyingOriginalTabIndex=i.attr("tabindex"),i.attr("tabindex","-1"),i.css("visibility","hidden"),d.fields[f.id]=f;var g='<iframe src="https://token.ultracart.com/checkout/checkout-hosted-fields-1.0.jsp?r='+Math.random()+"&t="+(new Date).getTime()+'" sandbox="allow-scripts allow-same-origin" style="width: 100%; height: 100%; border: none; padding: 0; margin: 0; overflow: hidden;"></iframe>';s.html(g),f.iframeContentWindow=s.find("iframe")[0].contentWindow,f.underlyingOriginalTabIndex&&s.find("iframe").attr("tabindex",f.underlyingOriginalTabIndex),f.retryIFrameLoadInMillis=5e3,f.retryCount=0,d.checkForLoad(f),d.maintainOverlay(f,i,s),f.checkForLoadTimer=setTimeout(function(){alert("Failed to load credit card field ["+t+"] after 60 seconds.\nPlease make sure that your browser is not blocking iframes.")},6e4)}},d.fieldReceiveMessageHandler=function(e){l&&console.log("fieldReceiveMessageHandler",e);var r=this;if("ready"===e.messageType){if(r.loaded=!0,clearTimeout(r.checkForLoadTimer),r.bufferedMessages.length){l&&console.log("There are "+r.bufferedMessages.length+" buffered messages to send to the hosted field.");for(var o=0;o<r.bufferedMessages.length;o++)r.iframeContentWindow.postMessage(t.stringify(r.bufferedMessages[o]),"*"),l&&console.log("Sent buffered message",r.bufferedMessages[o]);r.bufferedMessages=[]}}else"creditCardNumberTokenized"===e.messageType?r.callback&&r.callback(e.card):"change"===e.messageType?(l&&console.log("process change message"),r.change?(l&&console.log("Calling change handler with value",e.value),r.change(e.value)):l&&console.log("no change method configured on fieldObject",r),r.tokenHolder&&e.token&&(r.tokenHolder.val(e.token),r.tokenHolder.trigger("change"))):"blur"===e.messageType?(r.underlying.triggerHandler("blur"),d.maintainOverlay(r.underlying,r.container)):"focus"===e.messageType&&(r.underlying.triggerHandler("focus"),d.maintainOverlay(r.underlying,r.container))},d.checkForLoad=function(e){var r=this;if(!e.loaded){e.retryIFrameLoadInMillis-=100,e.retryIFrameLoadInMillis<=0&&(e.retryCount++,e.retryIFrameLoadInMillis=5e3,l&&console.log("Retry iframe load count",e.retryCount),e.container.find("iframe").attr("src","https://token.ultracart.com/checkout/checkout-hosted-fields-1.0-dev-alpha.jsp?r="+Math.random()+"&t="+(new Date).getTime())),l&&e.retryIFrameLoadInMillis%1e3==0&&console.log("Retry iframe load in millis",e.retryIFrameLoadInMillis);var o={messageType:"readyCheck",id:e.id,sessionCredentials:d.sessionCredentials,cssUrls:d.cssUrls,fieldType:e.fieldType,fieldConfig:{value:e.fieldConfig.value,placeholder:e.fieldConfig.placeholder},debugMode:l};e.iframeContentWindow.postMessage(t.stringify(o),"*"),setTimeout(function(){r.checkForLoad(e)},100)}},d.receiveMessageHandler=function(e){if(l&&console.log("parent receiveMessage",e),"https://token.ultracart.com"===e.origin){var r=null;try{r=t.parse(e.data)}catch(o){alert("Error parsing message from hosted field.")}r&&r.id&&d.fields[r.id]&&d.fields[r.id].receiveMessageHandler(r)}},d.maintainOverlay=function(e,r,o){try{if(e.loaded&&s.length>0){var a=d.getStyles(r,s),i=t.stringify(a);if(e.lastUnderlyingCssJson!==i){e.lastUnderlyingCssJson=i;var n={messageType:"setStyles",styles:a};e.iframeContentWindow.postMessage(t.stringify(n),"*")}}}catch(c){}try{if(e.loaded){var f=r.val();if(f&&e.lastUnderlyingVal!==f){e.lastUnderlyingVal=f,l&&console.log("Notify hosted field of value.  Autofill plugin");var g={messageType:"setValue",value:f};e.iframeContentWindow.postMessage(t.stringify(g),"*")}}}catch(c){}try{var u=r.position(),h=u.top+(parseInt(r.css("margin-top"))||0),v=u.left+(parseInt(r.css("margin-left"))||0),m=o.position();if(u&&m){var p=Math.abs(h-m.top),y=Math.abs(v-m.left);if(p>=1||y>=1)d.matchOverlay(r,o);else{var b=Math.abs(r.outerWidth(!1)-o.outerWidth(!1)),C=Math.abs(r.outerHeight(!1)-o.outerHeight(!1));(b>=1||C>=1)&&d.matchOverlay(r,o)}}}catch(c){}setTimeout(function(){d.maintainOverlay(e,r,o)},100)},d.maintainSelectOverlay=function(e,t){try{var r;if(e.is(":visible")&&!e.is(":hidden")){var o=e.position();t.is(":hidden")&&(l&&console.log("Restoring overlay for select since underlying is now visible."),t.show());var a=o.top+(parseInt(e.css("margin-top"))||0),i=o.left+(parseInt(e.css("margin-left"))||0);if(r=t.position(),o&&r){var n=Math.abs(a-r.top),s=Math.abs(i-r.left);if(n>=1||s>=1)d.matchOverlay(e,t);else{var c=Math.abs(e.outerWidth(!1)-t.outerWidth(!1)),f=Math.abs(e.outerHeight(!1)-t.outerHeight(!1));(c>=1||f>=1)&&d.matchOverlay(e,t)}}}else t.is(":hidden")||(l&&console.log("Hiding overlay for select since underlying is no longer visible."),t.hide())}catch(g){}setTimeout(function(){d.maintainSelectOverlay(e,t)},100)},d.matchOverlay=function(e,t){var r=e.position(),o=r.top+(parseInt(e.css("margin-top"))||0),a=r.left+(parseInt(e.css("margin-left"))||0);t.css("position","absolute"),t.css("top",o),t.css("left",a),t.css("width",e.outerWidth(!1)),t.css("height",e.outerHeight(!1)),t.css("z-index",n)},d.destroy=function(){r.removeEventListener("message",d.receiveMessageHandler);for(var t=0;t<d.fields.length;t++){var o=d.fields[t];o&&(o.checkForLoadTimer&&clearTimeout(o.checkForLoadTimer),o.container.remove(),o.underlyingOriginalTabIndex?o.underlying.attr("tabIndex",o.underlyingOriginalTabIndex):o.underlying.removeAttr("tabIndex"),o.underlying.css("visibility","visible"))}d.form&&e(d.form).off("submit",d.enableInputsForSubmit)},d.addClass=function(e,r){r||(r="all");for(var o=0;o<d.fields.length;o++){var a=d.fields[o];if(a&&(a.fieldType===r||"all"===r)){var i={messageType:"addClass",className:e};a.loaded?a.iframeContentWindow.postMessage(t.stringify(i),"*"):a.bufferedMessages.push(i)}}},d.removeClass=function(e,r){r||(r="all");for(var o=0;o<d.fields.length;o++){var a=d.fields[o];if(a&&(a.fieldType===r||"all"===r)){var i={messageType:"removeClass",className:e};a.loaded?a.iframeContentWindow.postMessage(t.stringify(i),"*"):a.bufferedMessages.push(i)}}},d.enableInputsForSubmit=function(){},d.getStyles=function(e,t,o){var a,i,n,s,l={};if(t&&t instanceof Array)for(n=0,s=t.length;s>n;n++)i=t[n],l[i]=e.css(i);else if(e.length){var d=e.get(0);if(r.getComputedStyle){var c=/\-([a-z])/g,f=function(e,t){return t.toUpperCase()},g=function(e){return e.replace(c,f)};if(a=r.getComputedStyle(d,null)){var u,h;if(a.length)for(n=0,s=a.length;s>n;n++)i=a[n],u=g(i),h=a.getPropertyValue(i),l[u]=h;else for(i in a)u=g(i),h=a.getPropertyValue(i)||a[i],l[u]=h}}else if(a=d.currentStyle)for(i in a)l[i]=a[i];else if(a=d.style)for(i in a)"function"!=typeof a[i]&&(l[i]=a[i])}if(o&&o instanceof Array)for(n=0,s=o.length;s>n;n++)i=o[n],delete l[i];return l},d.form&&e(d.form).on("submit",d.enableInputsForSubmit),r.addEventListener?r.addEventListener("message",d.receiveMessageHandler,!1):r.attachEvent&&r.attachEvent("onmessage",d.receiveMessageHandler)},!window.addEventListener&&function(e,t,r,o,a,i,n){e[o]=t[o]=r[o]=function(e,t){var r=this;n.unshift([r,e,t,function(e){e.currentTarget=r,e.preventDefault=function(){e.returnValue=!1},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||r,t.call(r,e)}]),this.attachEvent("on"+e,n[0][3])},e[a]=t[a]=r[a]=function(e,t){for(var r,o=0;r=n[o];++o)if(r[0]==this&&r[1]==e&&r[2]==t)return this.detachEvent("on"+e,n.splice(o,1)[0][3])},e[i]=t[i]=r[i]=function(e){return this.fireEvent("on"+e.type,e)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[]),UltraCartHostedFields.setup=function(e,t,r){var o=new UltraCartHostedFields(e,t,window,r.sessionCredentials,r.form,r.cssUrls,r.overlayZIndex||999999,r.autoCopyStyles,window.ultraCartHostedFieldsDebugMode||!1);if(r&&r.hostedFields){if(r.hostedFields.creditCardNumber){var a=r.hostedFields.creditCardNumber;if(a.selector){var i;if(i=a.selectorContext?e(a.selector,a.selectorContext):e(a.selector),1==i.size())o.setupField("creditCardNumber",a);else if(0==i.size())if(a.alertIfMissing)alert("Selector for creditCardNumber did not find the element on the page.\nPlease make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup().");else try{console&&(console.error?console.error("Selector for creditCardNumber did not find the element on the page. Please make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup()."):console.log&&console.log("Selector for creditCardNumber did not find the element on the page. Please make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup()."))}catch(n){}else i.size()>1&&alert("Selector for creditCardNumber found more than one element.")}else alert("No selector specified for creditCardNumber field.")}if(r.hostedFields.creditCardCvv2){var s=r.hostedFields.creditCardCvv2;if(s.selector){var l;if(l=s.selectorContext?e(s.selector,s.selectorContext):e(s.selector),1==l.size())o.setupField("creditCardCvv2",s);else if(0==l.size())if(s.alertIfMissing)alert("Selector for creditCardCvv2 did not find the element on the page.\nPlease make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup().");else try{console&&(console.error?console.error("Selector for creditCardCvv2 did not find the element on the page. Please make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup()."):console.log&&console.log("Selector for creditCardCvv2 did not find the element on the page. Please make sure that the element exists and is attached to the DOM before calling UltraCartHostedFields.setup()."))}catch(n){}else l.size()>1&&alert("Selector for creditCardCvv2 found more than one element.")}else alert("No selector specified for creditCardCvv2 field.")}navigator.userAgent&&-1!=navigator.userAgent.indexOf("AppleWebKit")&&-1!=navigator.userAgent.indexOf("Mobile")&&-1==navigator.userAgent.indexOf("Android")&&o.preventIPadSelectCrashes()}return o};
